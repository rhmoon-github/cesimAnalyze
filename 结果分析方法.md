# 商业模拟竞赛结果分析方法论

**版本**：3.0（成熟版 - 基于0-3回合数据优化）
**适用数据**：ir00, pr01, pr02, pr03 四回合Excel结果文件
**核心目标**：在结果公布后2小时内，从原始表格数据生成可执行的决策洞察
**更新时间**：2025-11-27

---

## 目录

1. [方法论概述](#第一章-方法论概述)
2. [数据基础建设](#第二章-数据基础建设)
3. [自身诊断分析](#第三章-自身诊断分析)
4. [竞争分析解码](#第四章-竞争分析解码)
5. [决策支持体系](#第五章-决策支持体系)
6. [标准输出模板](#第六章-标准输出模板)
7. [工具与方法库](#第七章-工具与方法库)
8. [迭代与优化](#第八章-迭代与优化)

---

## 第一章 方法论概述

### 1.1 方法论定位

**适用场景**：

- ✅ 商业模拟竞赛（如Cesim）回合结果分析
- ✅ 多回合（0-3回合）数据对比分析
- ✅ 快速决策支持（2小时内完成）

**核心价值**：

- 📊 从原始Excel表格直接生成分析洞察
- 🎯 提供量化的决策建议和风险评估
- 🔄 支持持续迭代和模型优化

### 1.2 分析流程总览

```
原始Excel数据
    ↓
【第一步：数据基础建设】（15分钟）
    ├─ 数据读取与解析
    ├─ 指标名称映射
    ├─ 数据验证与清洗
    └─ 衍生指标计算
    ↓
【第二步：自身诊断分析】（30分钟）
    ├─ 财务健康度诊断
    ├─ 现金流分析
    └─ 市场表现评估
    ↓
【第三步：竞争分析解码】（40分钟）
    ├─ 对手策略识别
    ├─ 策略突变检测
    └─ 下回合意图预测
    ↓
【第四步：决策支持体系】（25分钟）
    ├─ 决策复盘
    ├─ 策略建议生成
    └─ 检查清单验证
    ↓
决策洞察报告
```

### 1.3 时间管理


| 阶段         | 时间分配    | 关键输出         |
| -------------- | ------------- | ------------------ |
| 数据基础建设 | 15分钟      | 标准化的数据字典 |
| 自身诊断分析 | 30分钟      | 财务健康度报告   |
| 竞争分析解码 | 40分钟      | 对手策略矩阵     |
| 决策支持体系 | 25分钟      | 策略建议清单     |
| 报告撰写     | 10分钟      | 最终分析报告     |
| **总计**     | **120分钟** | **完整决策支持** |

---

## 第二章 数据基础建设

### 2.1 数据源识别

**输入文件**：

- `results-ir00.xls` - 初始回合（回合0）
- `results-pr01.xls` - 第一回合
- `results-pr02.xls` - 第二回合
- `results-pr03.xls` - 第三回合

**文件结构**：

- Sheet名称：`Results`
- 队伍名称位置：第5行（索引4）
- 数据起始位置：第6行（索引5）
- 指标名称位置：第1列

### 2.2 指标名称映射体系

**问题背景**：Excel中指标名称多样，同一概念可能有多种命名。

**映射原则**：

1. **精确匹配优先**：先尝试精确匹配标准名称
2. **模糊匹配兜底**：精确匹配失败时，使用关键词匹配
3. **日期筛选**：多个匹配结果时，优先选择包含日期或"合计"的指标
4. **提取日志**：记录每个指标的实际提取名称，便于验证

#### 2.2.1 核心财务指标映射


| 标准名称     | Excel可能命名                                         | 提取策略                         | 优先级 |
| -------------- | ------------------------------------------------------- | ---------------------------------- | -------- |
| **现金**     | `现金 31.12.`、`现金 1.1.`、`现金及等价物变化`        | 模糊匹配"现金"，优先选择含日期的 | P0     |
| **权益合计** | `权益合计`                                            | 精确匹配                         | P0     |
| **总资产**   | `总资产`                                              | 精确匹配                         | P0     |
| **销售额**   | `销售额合计`、`本地销售额`、`当地销售额`              | 优先"合计"，或求和区域销售额     | P0     |
| **EBITDA**   | `息税折旧及摊销前利润(EBITDA)`                        | 精确匹配包含"EBITDA"             | P0     |
| **净利润**   | `净利润`、`税后利润`                                  | 模糊匹配                         | P1     |
| **短期贷款** | `短期贷款（无计划）`、`短期贷款变化(增加 + / 减少 -)` | 优先无变化项                     | P0     |
| **长期贷款** | `长期贷款`、`长期贷款变化(增加 + / 减少 -)`           | 优先无变化项                     | P0     |
| **研发**     | `研发`                                                | 精确匹配                         | P0     |
| **广告**     | `广告`                                                | 精确匹配                         | P0     |

#### 2.2.2 区域市场指标映射


| 标准名称   | Excel命名    | 提取策略 |
| ------------ | -------------- | ---------- |
| 在美国销售 | `在美国销售` | 精确匹配 |
| 在亚洲销售 | `在亚洲销售` | 精确匹配 |
| 在欧洲销售 | `在欧洲销售` | 精确匹配 |

**注意**：原始Excel中**不存在直接的"市场份额"指标**，需要通过销售额计算。

### 2.3 数据验证与清洗

#### 2.3.1 数据完整性验证

```python
# 验证公式（宽松模式）
def validate_data_integrity(assets, equity, short_debt, long_debt):
    """
    验证：总资产 ≈ 权益 + 短期负债 + 长期负债
    误差容忍度：5-10%（考虑会计科目复杂性）
    """
    calculated = equity + (short_debt or 0) + (long_debt or 0)
    if assets == 0:
        return None
  
    error_rate = abs(assets - calculated) / abs(assets) * 100
  
    if error_rate < 10:
        return "数据基本一致"
    elif error_rate < 50:
        return "需要人工核查"
    else:
        return "数据异常，需排除"
```

#### 2.3.2 异常值检测


| 异常类型   | 检测规则       | 处理方式           | 标记符号 |
| ------------ | ---------------- | -------------------- | ---------- |
| 现金极端值 | >$1.5M 或 <$5k | 标记并分析原因     | 🔴       |
| 负权益     | 权益合计 < 0   | 标记为严重风险     | 🔴       |
| 数据缺失   | 关键指标为NULL | 标记并尝试替代计算 | ⚠️     |

### 2.4 衍生指标计算

**必须计算的衍生指标**：

```python
# 1. 环比增长率
环比增长率 = (本期值 - 上期值) / abs(上期值) * 100

# 2. 行业统计量
行业均值 = mean(所有队伍该指标)
行业中位数 = median(所有队伍该指标)
行业标准差 = std(所有队伍该指标)

# 3. 排名变化
排名变化 = 本期排名 - 上期排名

# 4. 战略偏离度
战略偏离度 = |自身指标 - 行业均值| / 行业均值 * 100

# 5. 财务健康度指标
净债务/权益比 = (短期贷款 + 长期贷款 - 现金) / 权益 * 100
EBITDA率 = EBITDA / 销售额 * 100
权益比率 = 权益 / 总资产 * 100
研发回报率 = 净利润 / 研发费用 * 100（研发费用>0时）
```

### 2.5 队伍名称标准化

```python
# 队伍名称映射表
TEAM_NAME_MAPPING = {
    '创世纪的大富翁': 'Blue',
    '星野四喜': 'Black',
    # 添加其他需要映射的队伍名称
}

# 标准化函数
def normalize_team_name(name):
    return TEAM_NAME_MAPPING.get(name, name)
```

---

## 第三章 自身诊断分析

### 3.1 财务健康度红绿灯系统

**系统目标**：快速识别财务风险，触发相应行动。

#### 3.1.1 指标定义与阈值


| 指标              | 绿灯（健康） | 黄灯（预警） | 红灯（危险） | 数据可用性 |
| ------------------- | -------------- | -------------- | -------------- | ------------ |
| **现金储备**      | >$300k       | $100k-$300k  | <$100k       | ✅ 可用    |
| **净债务/权益比** | <30%         | 30%-70%      | >70%         | ✅ 可用    |
| **EBITDA率**      | >20%         | 5%-20%       | <5%或负值    | ✅ 可用    |
| **权益比率**      | >100%        | 50%-100%     | <50%         | ✅ 可用    |
| **研发回报率**    | >15%         | 0%-15%       | <0%          | ✅ 可用    |

**阈值校准说明**：

- 现金储备、净债务/权益比、研发回报率：基于行业经验，阈值合理
- EBITDA率：从>40%调整为>20%（更符合实际数据分布）
- 权益比率：从>60%调整为>100%（实际数据普遍>100%，阈值需重新理解）

#### 3.1.2 行动触发机制

```python
def get_action_required(health_status):
    """
    根据财务健康度状态，返回行动建议
    """
    red_count = count_red_lights(health_status)
    yellow_count = count_yellow_lights(health_status)
  
    if red_count > 2:
        return "⚠️ 立即进入生存模式（停止投资、削减成本）"
    elif yellow_count > 3 or red_count > 0:
        return "⚠️ 召开紧急战略复盘会"
    elif red_count == 0 and yellow_count <= 1:
        return "✅ 可考虑激进扩张"
    else:
        return "📊 维持当前策略，密切观察"
```

### 3.2 现金流源头分析

**分析目标**：识别现金流来源，判断财务健康可持续性。

#### 3.2.1 现金流模式识别

```python
def classify_cash_flow_type(cash_change, ebitda, prev_cash):
    """
    分类现金流类型
    """
    # A. 经营驱动型（健康）
    if ebitda > 100000:
        return {
            'type': 'A. 经营驱动型（健康）',
            'description': f'经营现金流+${ebitda/1000:.0f}k → 可扩张',
            'risk': '低'
        }
  
    # B. 融资驱动型（危险）
    elif cash_change > 0 and abs(ebitda) < abs(cash_change) * 0.5:
        return {
            'type': 'B. 融资驱动型（危险）',
            'description': '融资现金流为主要来源 → 不可持续',
            'risk': '高'
        }
  
    # C. 投资消耗型（过渡期）
    else:
        return {
            'type': 'C. 投资消耗型（过渡期）',
            'description': '投资现金流消耗现金 → 关注下回合回报',
            'risk': '中'
        }
```

#### 3.2.2 现金流趋势分析

- 计算每回合的现金变化
- 对比经营现金流（EBITDA）与现金变化的比例
- 识别现金来源的可持续性

### 3.3 市场表现评估

**数据限制说明**：原始Excel中不存在直接的"市场份额"和"满足度"指标，需使用替代方法。

#### 3.3.1 区域市场份额计算（替代方案）

```python
def calculate_region_market_share(team_sales, all_teams_sales):
    """
    计算区域市场份额（替代方案）
    市场份额 = 本队区域销售额 / 该区域所有队伍销售额之和
    """
    total_sales = sum(all_teams_sales.values())
    if total_sales == 0:
        return None
    return (team_sales / total_sales) * 100

def get_region_ranking(team_sales, all_teams_sales):
    """
    获取区域销售额排名（替代方案）
    """
    sorted_teams = sorted(all_teams_sales.items(), key=lambda x: x[1], reverse=True)
    for rank, (team, sales) in enumerate(sorted_teams, 1):
        if team == target_team:
            return rank
    return None
```

#### 3.3.2 区域市场策略建议


| 销售额排名    | 销售趋势 | 策略建议           |
| --------------- | ---------- | -------------------- |
| 前3名         | 增长     | 巩固优势，考虑提价 |
| 前3名         | 稳定     | 增加功能或广告投入 |
| 中游（4-8名） | 增长     | 加大投入，抢占份额 |
| 中游          | 下降     | 评估退出或差异化   |
| 后3名         | -        | 退出或大幅调整策略 |

#### 3.3.3 多回合趋势分析

```python
def analyze_trend(metric_name, rounds_data):
    """
    分析多回合趋势
    返回：趋势方向、变化率、稳定性评分
    """
    values = [rounds_data[rnd].get(metric_name) for rnd in ['ir00', 'pr01', 'pr02', 'pr03']]
  
    # 计算趋势
    if len(values) >= 2:
        overall_change = (values[-1] - values[0]) / abs(values[0]) * 100 if values[0] != 0 else 0
        recent_change = (values[-1] - values[-2]) / abs(values[-2]) * 100 if values[-2] != 0 else 0
    
        return {
            'overall_change': overall_change,
            'recent_change': recent_change,
            'trend': '上升' if overall_change > 0 else '下降' if overall_change < 0 else '稳定'
        }
```

---

## 第四章 竞争分析解码

### 4.1 三维度对标矩阵

**分析目标**：识别对手策略特征，定位竞争态势。

#### 4.1.1 维度定义

```python
def calculate_competitive_position(metrics_dict, team):
    """
    计算三维度竞争态势
    """
    equity = get_metric_value(metrics_dict, '权益合计', team) or 0
    short_debt = get_metric_value(metrics_dict, '短期贷款', team) or 0
    long_debt = get_metric_value(metrics_dict, '长期贷款', team) or 0
    cash = get_metric_value(metrics_dict, '现金', team) or 0
    sales = get_metric_value(metrics_dict, '销售额', team) or 0
    rd_expense = get_metric_value(metrics_dict, '研发', team) or 0
    ad_expense = get_metric_value(metrics_dict, '广告', team) or 0
  
    # 1. 财务激进度
    if equity > 0:
        net_debt = (short_debt + long_debt) - cash
        financial_aggressiveness = (net_debt / equity) * 100
    else:
        financial_aggressiveness = 999  # 极端激进
  
    # 2. 市场侵略性（简化版）
    market_aggressiveness = (ad_expense / sales * 100) if sales > 0 else 0
  
    # 3. 技术投入度
    tech_investment = (rd_expense / sales * 100) if sales > 0 else 0
  
    return {
        '财务激进度': financial_aggressiveness,
        '市场侵略性': market_aggressiveness,
        '技术投入度': tech_investment
    }
```

#### 4.1.2 策略类型识别

```python
def identify_strategy_type(competitive_position, metrics_dict, team):
    """
    识别策略类型
    """
    tech_investment = competitive_position['技术投入度']
    rd_expense = get_metric_value(metrics_dict, '研发', team) or 0
    profit = get_metric_value(metrics_dict, '净利润', team) or 0
    sales = get_metric_value(metrics_dict, '销售额', team) or 0
  
    if tech_investment > 20 and rd_expense > 0:
        ros = (profit / sales * 100) if sales > 0 else 0
        if ros > 20:
            return '战略清晰（高投入+高回报）'
        else:
            return '策略试错（高投入+低回报）'
    elif tech_investment < 1 and profit and profit > 0:
        return '市场套利（零研发+高利润）'
    else:
        return '稳健经营'
```

### 4.2 策略突变检测

**检测目标**：及时发现对手策略变化，提前应对。

#### 4.2.1 可执行的检测项

```python
def detect_strategy_changes(all_rounds_data, teams):
    """
    检测策略突变（仅包含有数据支持的部分）
    """
    alerts = {}
    rounds = ['ir00', 'pr01', 'pr02', 'pr03']
  
    for team in teams:
        alerts[team] = []
    
        # 1. 现金异常波动（最重要，数据最可靠）
        for i in range(len(rounds) - 1):
            rnd1, rnd2 = rounds[i], rounds[i+1]
            cash1 = get_metric_value(all_rounds_data[rnd1], '现金', team) or 0
            cash2 = get_metric_value(all_rounds_data[rnd2], '现金', team) or 0
            cash_change = abs(cash2 - cash1)
        
            if cash_change > 500000:
                alerts[team].append({
                    'type': '现金异常波动',
                    'round': f'{rnd1}→{rnd2}',
                    'value': cash_change,
                    'interpretation': '可能融资/出售资产' if cash2 > cash1 else '可能大幅投资/亏损'
                })
    
        # 2. 战略稳定性指数
        for i in range(len(rounds) - 1):
            rnd1, rnd2 = rounds[i], rounds[i+1]
            metrics1 = all_rounds_data[rnd1]
            metrics2 = all_rounds_data[rnd2]
        
            ebitda1 = get_metric_value(metrics1, 'EBITDA', team) or 0
            ebitda2 = get_metric_value(metrics2, 'EBITDA', team) or 0
            rd1 = get_metric_value(metrics1, '研发', team) or 0
            rd2 = get_metric_value(metrics2, '研发', team) or 0
            assets1 = get_metric_value(metrics1, '总资产', team) or 0
        
            if assets1 > 0:
                stability_index = 1 - (abs(ebitda2 - ebitda1) + abs(rd2 - rd1)) / assets1
                if stability_index < 0.3:
                    alerts[team].append({
                        'type': '战略稳定性低',
                        'round': f'{rnd1}→{rnd2}',
                        'value': stability_index,
                        'interpretation': '策略变化剧烈，需重点关注'
                    })
  
    return alerts
```

#### 4.2.2 区域市场进入检测（替代方案）

```python
def detect_region_entry(all_rounds_data, teams):
    """
    检测区域市场进入（使用销售额替代市场份额）
    """
    region_entry_alerts = {}
    rounds = ['ir00', 'pr01', 'pr02', 'pr03']
    regions = ['美国', '亚洲', '欧洲']
  
    for team in teams:
        region_entry_alerts[team] = []
    
        for region in regions:
            sales_key = f'在{region}销售'
            prev_sales = 0
        
            for rnd in rounds:
                if rnd in all_rounds_data:
                    current_sales = get_metric_value(all_rounds_data[rnd], sales_key, team) or 0
                    if prev_sales == 0 and current_sales > 10000:  # 从无到有，销售额>10k
                        region_entry_alerts[team].append({
                            'region': region,
                            'round': rnd,
                            'sales': current_sales,
                            'interpretation': f'新进入{region}市场'
                        })
                    prev_sales = current_sales
  
    return region_entry_alerts
```

### 4.3 下回合意图预测

**预测目标**：基于当前数据和趋势，预测对手下回合可能行动。

#### 4.3.1 预测模型（使用可用指标）

```python
def predict_next_move(team_data, trend_data):
    """
    下回合意图预测（基于可用指标）
    """
    signals = []
  
    # 1. 扩产信号
    if team_data['现金'] > 300000:
        sales_growth = trend_data.get('销售额环比增长', 0)
        if sales_growth > 0.1:  # 销售额增长>10%
            signals.append({
                'action': '扩产',
                'probability': 70,
                'reason': '现金充足+销售增长'
            })
  
    # 2. 价格战信号
    if team_data['现金'] > 500000:
        sales_rank = trend_data.get('销售额排名', 999)
        if sales_rank > 8:  # 排名后4位
            signals.append({
                'action': '价格战',
                'probability': 60,
                'reason': '现金充足+排名靠后'
            })
  
    # 3. 技术投入信号
    if team_data['研发'] > 400000:
        signals.append({
            'action': '技术投入',
            'probability': 75,
            'reason': '研发投入大，可能推出新技术'
        })
  
    # 4. 财务危机信号
    if team_data['净债务/权益'] > 100 and team_data['EBITDA'] < 0:
        signals.append({
            'action': '出售资产/退出',
            'probability': 80,
            'reason': '财务危机（高负债+负EBITDA）'
        })
  
    # 5. 现金危机信号
    if team_data['现金'] < 50000 and team_data['净债务/权益'] > 70:
        signals.append({
            'action': '紧急融资',
            'probability': 85,
            'reason': '现金不足+高负债'
        })
  
    return signals
```

#### 4.3.2 预测准确率校准

- 每回合结束后，对比预测与实际结果
- 调整模型参数和阈值
- 建立预测准确率统计表

---

## 第五章 决策支持体系

### 5.1 决策复盘分析

#### 5.1.1 决策-结果映射模板


| 上回合决策 | 预期效果          | 实际结果        | 偏差分析               | 改进措施               |
| ------------ | ------------------- | ----------------- | ------------------------ | ------------------------ |
| 投入研发$X | 功能+2，溢价+10%  | 功能+1，溢价+5% | 对手也加功能，竞争加剧 | 下回合加大广告强化认知 |
| 区域扩产   | 满足需求，利润+$Y | 利用率仅65%     | 需求预测错误           | 建立动态需求模型       |
| 降价策略   | 份额+3%           | 份额-1%         | 对手降价更多           | 价格战后恢复原价       |

#### 5.1.2 累积效应分析

```python
# 投入回报周期
RETURN_CYCLES = {
    '研发投入': 2,  # 2回合回报周期
    '广告投入': 1,  # 1回合回报周期
    '产能投资': 3,  # 3回合回报周期
}

# 案例：Red回合0-2
# 回合0：研发$619k → 回合1：功能提升 → 回合2：市场份额提升
# 总回报 = 利润增量 / 投入成本 = ROI
```

### 5.2 下回合策略建议生成

#### 5.2.1 资源分配决策树

```
现金储备如何分配？
├── < $100k → 生存模式
│   ├── 停止所有投资
│   ├── 出售闲置产能
│   └── 削减非必要费用
│
├── $100k-$300k → 维持模式
│   ├── 仅必要广告投入
│   ├── 维持现有产能
│   └── 保留现金缓冲
│
└── > $300k → 进攻模式
    ├── 销售增长>10% → 扩产（60%资金）
    ├── 技术空白市场 → 研发+进入（40%资金）
    ├── 份额>15% → 增加广告巩固（30%资金）
    └── 保留20%现金应对风险
```

#### 5.2.2 情景分析模板

**悲观情景（30%概率）**：

- 假设：3个新对手进入主要市场
- 影响：售价下降15%，份额下降5%
- 应对：提前降价锁定客户，预留现金防御

**基准情景（50%概率）**：

- 假设：市场按当前趋势增长5%
- 行动：维持策略，观察对手动态

**乐观情景（20%概率）**：

- 假设：新技术需求爆发
- 准备：预留$200k研发快速跟进

### 5.3 核心检查清单

**提交决策前必答问题**：

#### 5.3.1 财务健康检查

- [ ] 现金储备是否覆盖3个回合的亏损？（≥$300k）
- [ ] 财务健康度红绿灯是否有2个以上红灯？
- [ ] 净债务/权益比是否在安全范围？（<70%）

#### 5.3.2 市场策略检查

- [ ] 区域销售额趋势是否向好？（增长/稳定/下降）
- [ ] 主要市场排名是否前3？（或正在上升）
- [ ] 是否识别出未开发的市场机会？

#### 5.3.3 竞争态势检查

- [ ] 对手现金异常波动是否已分析？（>500k变化）
- [ ] 对手可能的3种反应是否有预案？
- [ ] 是否识别出主要威胁和机会？

#### 5.3.4 风险控制检查

- [ ] 是否保留至少20%现金作为风险缓冲？
- [ ] 是否考虑了最坏情景（悲观情景）？
- [ ] 策略是否具有灵活性（可调整性）？

---

## 第六章 标准输出模板

### 6.1 分析报告结构

```markdown
# 企业模拟经营战报分析报告（回合N）

## 一、执行摘要
- 当前排名：第X名
- 关键指标：利润$X，环比+/-X%
- 主要驱动因素：X
- 核心问题：不超过3个

## 二、财务健康诊断
- 财务健康度红绿灯表
- 现金流源头分析
- 财务风险评估

## 三、市场表现分析
- 区域市场表现（销售额排名、趋势）
- 多回合趋势对比

## 四、竞争态势分析
- 三维度对标矩阵
- 对手策略突变检测
- 下回合意图预测

## 五、决策建议
- 上回合决策复盘
- 下回合策略建议
- 资源分配方案
- 风险应对预案

## 六、行动清单
- 立即执行项（3-5项）
- 本周执行项（5-8项）
- 观察监控项（3-5项）
```

### 6.2 关键图表清单

1. **财务健康度仪表盘**

   - 5个指标的当前状态（红/黄/绿）
   - 多回合趋势对比
2. **竞争态势矩阵图**

   - X轴：财务激进度
   - Y轴：技术投入度
   - 气泡大小：市场侵略性
   - 颜色：策略类型
3. **多回合趋势对比图**

   - 销售额、净利润、现金等关键指标
   - 4回合（ir00-pr03）对比
4. **区域市场表现图**

   - 3个区域的销售额排名
   - 趋势箭头（上升/下降）

### 6.3 数据表格标准格式

#### 财务健康度表


| 队伍     | 现金储备 | 净债务/权益比 | EBITDA率 | 权益比率  | 研发回报率 | 综合评级 |
| ---------- | ---------- | --------------- | ---------- | ----------- | ------------ | ---------- |
| 做大做强 | $391k 🟢 | -94.0% 🟢     | N/A 🔴   | 101.1% 🟢 | 0.0% 🟡    | 🟡 关注  |

#### 竞争对标矩阵表


| 队伍 | 财务激进度 | 市场侵略性 | 技术投入度 | 策略类型 |
| ------ | ------------ | ------------ | ------------ | ---------- |
| Red  | 170.4%     | 0.0%       | 0.0%       | 未知     |

---

## 第七章 工具与方法库

### 7.1 数据提取工具

**Python代码示例**：

```python
from utils_data_analysis import read_excel_data, find_metric, get_metric_value

# 读取数据
metrics_dict, teams = read_excel_data('results-pr03.xls')

# 查找指标
cash_data = find_metric(metrics_dict, ['现金'])

# 获取值
cash_value = get_metric_value(metrics_dict, '现金', '做大做强')
```

### 7.2 计算公式库

#### 财务指标计算公式

```python
# 净债务/权益比
net_debt_equity_ratio = ((short_debt + long_debt - cash) / equity) * 100

# EBITDA率
ebitda_rate = (ebitda / sales) * 100

# 权益比率
equity_ratio = (equity / assets) * 100

# 研发回报率
rd_return = (profit / rd_expense) * 100  # 当rd_expense > 0时

# 销售利润率
ros = (profit / sales) * 100

# ROE
roe = (profit / equity) * 100
```

#### 趋势分析公式

```python
# 环比增长率
环比增长率 = ((current_value - previous_value) / abs(previous_value)) * 100

# 累计变化率
累计变化率 = ((final_value - initial_value) / abs(initial_value)) * 100

# 战略稳定性指数
stability_index = 1 - (abs(ΔEBITDA) + abs(Δ研发)) / 上期总资产
```

### 7.3 阈值配置表


| 指标          | 绿灯阈值 | 黄灯阈值    | 红灯阈值 | 数据来源     |
| --------------- | ---------- | ------------- | ---------- | -------------- |
| 现金储备      | >$300k   | $100k-$300k | <$100k   | 行业经验     |
| 净债务/权益比 | <30%     | 30%-70%     | >70%     | 行业经验     |
| EBITDA率      | >20%     | 5%-20%      | <5%      | pr03数据校准 |
| 权益比率      | >100%    | 50%-100%    | <50%     | pr03数据校准 |
| 研发回报率    | >15%     | 0%-15%      | <0%      | 行业经验     |

**阈值校准方法**：

- 使用分位数：75%分位以上=绿灯，25%-75%分位=黄灯，25%分位以下=红灯
- 或使用相对排名：前25%=绿灯，25%-75%=黄灯，后25%=红灯

---

## 第八章 迭代与优化

### 8.1 知识库更新机制

每回合结束后，必须更新：

```markdown
## 策略模式库
{
    '策略名称': {
        '特征': ['特征1', '特征2'],
        '案例': ['队伍X回合Y'],
        '效果': 'ROI: X%, 成功率: Y%'
    }
}

## 对手档案
{
    '队伍名称': {
        '回合N': {
            '假设': ['假设1', '假设2'],
            '实际': ['实际行为1', '实际行为2'],
            '偏差原因': '原因分析'
        }
    }
}

## 模型校准记录
{
    '预测模型': {
        '准确率': 'X%',
        '误报率': 'Y%',
        '调整参数': '参数列表',
        '下次调整时间': '回合N+1'
    }
}
```

### 8.2 持续改进流程

1. **每回合结束后**：

   - 对比预测与实际结果
   - 记录预测准确率
   - 识别模型偏差
2. **每3回合**：

   - 重新校准阈值（基于最新数据分布）
   - 更新指标映射表（发现新指标名称）
   - 优化预测模型参数
3. **整个比赛结束后**：

   - 总结方法论有效性
   - 识别改进点
   - 更新方法论文档

### 8.3 质量保证检查

**数据质量检查**：

- [ ] 所有关键指标是否成功提取？
- [ ] 数据完整性验证是否通过？
- [ ] 异常值是否已标记和分析？

**分析质量检查**：

- [ ] 财务健康度判断是否合理？
- [ ] 对手策略分析是否有数据支持？
- [ ] 预测模型的输入数据是否完整？

**输出质量检查**：

- [ ] 报告是否包含所有必要部分？
- [ ] 建议是否具体可执行？
- [ ] 风险评估是否充分？

---

## 附录

### A. 指标名称完整映射表

（见第2.2节）

### B. 计算公式完整列表

（见第7.2节）

### C. 常见问题FAQ

**Q1: 如果某个指标提取失败怎么办？**

- A: 首先尝试模糊匹配，如果仍失败，标记为"数据不可用"，使用替代指标或跳过该分析项。

**Q2: 阈值如何校准？**

- A: 基于实际数据分布，使用分位数或相对排名。每3回合重新校准一次。

**Q3: 预测准确率如何提高？**

- A: 结合多回合数据，考虑趋势因素，定期回顾和调整模型参数。
